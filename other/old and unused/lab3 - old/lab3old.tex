\documentclass[11pt]{article}


\include{labStyle}

\begin{document}

\section*{Lab 3: Distributions of random variables}

In this lab we'll investigate the probability distribution that is most central to statistics: the normal distribution.  If we know or assume that our data are normally distributed, that opens the door to many powerful statistical methods.  Here we'll use the graphical tools of R to assess the normality of our data and also learn how to generate random numbers from a normal distribution

%

\subsection*{The Data}

This week we will be working with measurements of body dimensions.

\begin{lstlisting}
download.file("http://www.openintro.org/stat/data/bdims.RData",
destfile = " bdims.RDat")
load("bdims.RData")
\end{lstlisting}

Let's take a quick peek at the first few rows of the data

\begin{lstlisting}
head(bdims)
\end{lstlisting}

You'll see that for every observation we have 25 measurements, many of which are either diameters or girths.  A key to the variable names is posted online
\footnote{This dataset comes from a paper entitled \emph{Exploring Relationships in Body Dimensions} by Heinz et. al.  For more information on the dataset, visit \web{http://www.amstat.org/publications/jse/datasets/body.txt}}, but we'll be focusing on just three columns to get started: height (\code{hgt}), weight (\code{wgt}), and sex

\begin{exercise}
q: describe the distributions.
q: how many male/female - do the dists change?
\end{exercise}


%

\subsection*{The normal distribution}

Let's focus first on the English Language \& Arts test scores of $5^{th}$ graders. We will use subsetting to find scores that satisfy these criteria and create a new vector called \texttt{ela5} that only contains English Language \& Arts scores of $5^{th}$ graders. While we're doing subsetting we'll also exclude observations that are \texttt{NA}s so that they don't complicate our analysis later.

\begin{lstlisting}
ela5 <- star$score[star$testID == "ela" & star$grade == "5" & !is.na(star$score)]
\end{lstlisting}

In the above code \texttt{!is.na} stands for \textit{is not NA}. Remember, R uses ``\texttt{!}" to mean \textit{not}. \\

Next let's check out the distribution of this variable.

\begin{lstlisting}
hist(ela5) 
summary(ela5)
\end{lstlisting}

\begin{exercise}
Describe the distribution of \texttt{ela5}. Do the data appear to follow a normal distribution?
\end{exercise}

We can overlay a normal distribution curve on a histogram of these data to see if the data follow a normal distribution. This normal curve should have the same mean and standard deviation as the data. Let's calculate those statistics first and store them as \texttt{ela5mean} and \texttt{ela5sd} in order to be able to reference them later.

\begin{lstlisting}
ela5mean <- mean(ela5)
ela5sd <- sd(ela5)
\end{lstlisting}

Next we make a density histogram to use as the backdrop, and use the \texttt{lines()} function to overlay a normal probability curve over this histogram. The difference between a relative frequency histogram and a density histogram is that while in a relative frequency histogram the \textit{heights} of the bars add up to 1, in a density histogram the \textit{areas} of the bars add up to 1. The area of each bar can be calculated as simply the height $\times$ the width of the bar. Using a density histogram allows us to properly overlay a normal distribution curve over the histogram since the curve is a normal probability density function. Frequency, relative frequency, and density histograms all display the same exact shape, however the y-axis is differs between the plots. You can verify this by scrolling between the frequency histogram you constructed earlier and the density histogram you just plotted.

\begin{lstlisting}
hist(ela5, probability = TRUE)
lines(x = 400:2600, y = dnorm(x = 400:2600, mean = ela5mean, sd = ela5sd), col = "blue")
\end{lstlisting}

The above code plots a line over an existing plot (the density histogram) with x coordinates between 400 and 2600 and y coordinates that follow a normal distribution with mean \texttt{ela5Mean} and standard deviation \texttt{ela5SD}. We chose the x range as 400 to 2600 in order to span the entire range of \texttt{ela5}. The last argument \texttt{col} simply sets the color for the line to be drawn. If we left the last argument out the line would be drawn in black.

\begin{exercise}
Based on the this plot, does it appear that the data follow a normal distribution?
\end{exercise}

%
\subsection*{Evaluating the normal distribution}

Eyeballing the shape of the histogram is one way to determine if the data appear to be normally distributed. But a more accurate approach involves constructing a normal probability plot for these data.

\begin{lstlisting}
qqnorm(ela5)
qqline(ela5)
\end{lstlisting}

Note that since calculating the quantiles for each observation in this large data set is computationally intensive, R might take some time to construct the normal probability plot.

\begin{exercise}
Based on the normal probability plot, does it appear that the data follow a normal distribution?
\end{exercise}

We can also check to see if the data follow the 68-95-99.7\% rule. To do so we first need to count how many observations are within 1, 2, and 3 standard deviations of the mean. This requires the use of logical statements in R. Below we give step by step instructions for counting how many observations are within one standard deviation of \texttt{ela5mean}.

{\small
\begin{itemize}

\item Calculate the lower bound: \texttt{ela5mean - ela5sd}

\item Calculate the upper bound: \texttt{ela5mean + ela5sd}

\item Mark each observation that is within 1 standard deviation of the mean as \texttt{TRUE}, and those that are outside this range as \texttt{FALSE}:

\begin{lstlisting}
within1sd <- ela5 > (ela5mean - ela5sd) \& ela5 < (ela5mean + ela5sd)
\end{lstlisting}

In the above code we determine which observations are above the lower bound \textit{and} below the upper bound, and mark those as \texttt{TRUE}. 

\item Count how many \texttt{TRUE}s are in the above vector by making a table:

\begin{lstlisting}
table(within1sd)
\end{lstlisting}

Alternatively, since R thinks of \texttt{TRUE}s as \texttt{1}s and \texttt{FALSE}s as \texttt{0}s we can just add up the \texttt{TRUE}s by using the \texttt{sum()} function.

\begin{lstlisting}
sum(within1sd)
\end{lstlisting}

\item Determine how many observations are in the data:

\begin{lstlisting}
ela5n <- length(ela5)
\end{lstlisting}

\item Lastly we divide the number of observations within 1 standard deviation of the mean by the total number of observations to determine what percent of the observations fall in this range:

\begin{lstlisting}
sum(within1sd) / ela5n
\end{lstlisting}

\end{itemize}
}

Let's make this a little cleaner by collapsing all these steps into one line of code:

\begin{lstlisting}
sum(ela5 > (ela5mean - ela5sd) \& ela5 < (ela5mean + ela5sd)) / ela5n
\end{lstlisting}

Similarly, we can calculate what percent of observations are within 2 standard deviations of the mean:

\begin{lstlisting}
sum(ela5 > (ela5mean - 2*ela5sd) \& ela5 < (ela5mean + 2*ela5sd)) / ela5n
\end{lstlisting}

\begin{exercise}
Calculate what percent of observation are within 3 standard deviations of the mean and evaluate if the data follow the 68-95-99.7\% rule.
\end{exercise}

%
\subsection*{Normal probabilities}

Using R we can calculate empirical probabilities or percentiles (based on the data) as well as theoretical probabilities from a normal distribution. If the data follow a normal distribution we would expect these probabilities to be similar.

Let's try to answer the question ``What is the probability that a randomly chosen $5^{th}$ grader scores lower than 1,500 on their English Language \& Arts test?".

If we want to calculate the probability empirically we simply need to determine how many observations fall below 1,500 and divide this number by the total sample size.

\begin{lstlisting}
sum(ela5 < 1500) / ela5n
\end{lstlisting}

The theoretical probability of scoring lower than 1,500 if the scores follow a normal distribution with mean \texttt{ela5mean} and standard deviation \texttt{ela5sd} can be calculated as:

\begin{lstlisting}
pnorm(q = 1500, mean = ela5mean, sd = ela5sd)
\end{lstlisting}

Note that the function \texttt{pnorm()} gives the area under the normal curve below a given value, \texttt{q}, with a given mean and standard deviation.

\begin{exercise}
Calculate the probability of a $5^{th}$ grader scoring above 2,000 empirically and also using a normal distribution model with mean \texttt{ela5mean} and standard deviation \texttt{ela5sd}. 
\end{exercise}

%
\subsection*{On Your Own}

Create a vector called \texttt{math5} representing the scores of $5^{th}$ graders on the standardized math test.

\begin{enumerate}

\item Make a density histogram of the scores of $5^{th}$ graders on the math test and overlay a normal distribution curve on the histogram. Describe the distribution of the scores of $5^{th}$ graders on the math test.

\item Make a normal probability plot of these scores and evaluate if the data follow a normal distribution.

\item Determine if the data follow the 68-95-99.7\% rule.

\item Calculate the probability that a randomly chosen $5^{th}$ grader scores between 1,500 and 2,500 on the math test. Calculate this probability empirically and also using a normal distribution with the same mean and standard deviation as the data.

\item Make a normal probability plot of scores from the geometry (\texttt{testID == "geometry"}) test as well as a normal probability plot of scores from the science 4 (\texttt{testID == "sci 4"}) test. Based on these normal probability plots determine if these distributions are symmetric, right skewed or left skewed. You can use a histogram to confirm your findings.

\item What concepts from the textbook are covered in this lab?  What concepts, if any, are not covered in the textbook?  Have you seen these concepts elsewhere, e.g. lecture, discussion section, previous labs, or homework problems?  Be specific in your answer.

\end{enumerate}


\end{document}


