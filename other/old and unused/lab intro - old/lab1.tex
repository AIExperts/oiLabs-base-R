\documentclass[11pt]{article}
\usepackage[top=3cm,bottom=3cm,left=3cm,right=3cm]{geometry}
\geometry{letterpaper}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{epstopdf}
\usepackage{xcolor}
\usepackage{enumerate}
\usepackage{colortbl}

\include{labStyle}

\begin{document}

\section*{Chapter 1 Lab: Introduction to Data}
\subsection*{Sampling from Millbrae, California}

In this lab, we'll investigate the ways in which the estimates that we make based on a random sample of data can inform us about what the population might look like.  We're interested in formulating a \emph{sampling distribution} of our estimate in order to get a sense of how good of an estimate it might be.

\subsubsection*{The Data}
The dataset that we'll be considering comes from the town of Millbrae, California, near San Francisco.  The U.S Census Bureau has recorded information on all 20,718 residents of Millbrae, including age and household income.  All residents of Millbrae will serve as our population.  In this lab we would like to learn as much as we can about the residents by taking smaller samples from the full population.  Let's load the data.

\Code{
set.seed(341)

data(millbrae)}

We see that two vectors are loaded into the workspace: \texttt{age}, which contains the ages of all 20,718 residents of Millbrae and \texttt{income}, which contains the incomes for all 500 households to which those residents belong.  For now, we'll focus on \texttt{age}.  Let's look at the distribution of ages in Millbrae by calculating some summary statistics and making a histogram.

\Code{summary(ages)

hist(ages)}

QUESTION 1: How would you describe this population distribution?

\subsubsection*{The Unknown Sampling Distribution}
In this lab, we have access to the entire population, but this is rarely the case in real life.  Gathering information on an entire population is often extremely costly or even impossible.  Because of this, we often take a smaller sample survey of the population and use that to make educated guesses about the properties of the population.

If we were interested in estimating the mean age in Millbrae, we can use the following command to survey the population.

\Code{samp1 <- sample(ages,75)}

This command allows us to create a new vector called \texttt{samp1} that is a simple random sample of size 75 from the population vector \texttt{ages}.  At a conceptual level, you can imagine randomly choosing 75 names from the Millbrae  phonebook, calling them up, and recording their ages.  Your would be correct in objecting that the phonebook probably doesn't contain all of the residents and that there will almost certainly be people that don't pick up the phone or refuse to give their age.  These are issues that can make gathering data very difficult and are a strong incentive to a high quality sample.

QUESTION 2: How would you describe the distribution of this sample?   How does it compare to the distribution of the population?

If we're interested in estimating the average age of all the residents in Millbrae, our best guess is going to be the sample mean from this simple random sample.

\Code{mean(samp1)}

Our estimate of the mean is 41.28, which is just a bit below the true population mean of 42.29.  So our sample mean turns out to be a pretty good estimate of the average age, and we were able to get it by sampling less than 1\% of the population.

\bigskip
QUESTION 3: Take a second sample, also of size 75, and call it \texttt{samp2}.  How does the mean of \texttt{samp2} compare with the mean of \texttt{samp1}?  If we took a third sample of size 150, intuitively would you expect the sample mean to be a better or worse estimate of the population mean?

Not surprisingly, every time we take another random sample, we get a different sample mean.  It's useful to get a sense of just how much variability we should expect when estimating the population mean this way.  This is what is captured by the \emph{sampling distribution}.  Because we have access to the population, we can build up the sampling distribution for the sample mean by repeating the above steps 5000 times.

\Code{sample.means <- rep(0,5000)}
\Code{for(i in 1:5000)\{

\Cindent samp <- sample(ages,75)

\Cindent sample.means[i] <- mean(samp)

\Cindent \}}
\Code{hist(sample.means,freq=FALSE)}

Here we rely on the computational ability of R to quickly take 5000 samples of size 75 from the population, compute each of those sample means, and store them in a vector called \texttt{sample.means}.

\bigskip
QUESTION 4: How many elements are there in \texttt{sample.means}?  How would you describe this sampling distribution?  Would you expect it to change if we instead collected 50,000 sample means?

\subsubsection*{Approximating the Sampling Distribution}
The sampling distribution that we just computed tells us everything that we would hope for about the average age of the residents of Millbrae.  Because the sample mean is an unbiased estimator, the sampling distribution is centered at the true average age of the the population and the spread of the distribution indicates how much variability is induced by sampling only 75 of the residents.

We computed the sampling distribution for mean age by drawing 5000 samples from the population and calculating 5000 sample means.  This was only possible because we had access to the population.  In most cases you don't (if you did, there'd be no need to estimate!).  Therefore, you have only your single sample to rely upon \ldots that, and the Central Limit Theorem.

The Central Limit Theorem states that, under certain conditions, the sample mean follows a normal distribution.  This allows us to make the inferential leap from our single sample to the full sampling distribution that describes every possibly sample mean you might come across.  But we need to look before we leap.

\bigskip
QUESTION 5: Does \texttt{sample1} meet the three conditions for the sample mean to be nearly normal, as described in section 4.4?
\bigskip

If the conditions are met, then we can find the approximate sampling distribution by plugging in our best estimate for the mean and standard error: $\bar{x}$ and $s/\sqrt{n}$.  

\Code{xbar <- mean(samp1)

se <- sd(samp1)/sqrt(75)

lines(seq(33,52,.1),dnorm(seq(33,52,.1),xbar,se))}

Notice that the command \texttt{lines} adds the curve of the the approximation to your existing histogram.  We can see that the line does a pretty good job of tracing the histogram that we derived from having access to the population.  In this case, our approximation based on the CLT is a good one.

\subsubsection*{Confidence Intervals}
Return for a moment to the question that first motivated this lab: what is our best estimate of the mean age of the residents of Millbrae?  If we were to take only one random sample, \texttt{sample1}, our best estimate would be $\bar{x}$.  That serves as a good \emph{point estimate} but it would be useful to also communicate how uncertain we are in that estimate.  That is exactly the information that is captured by the sampling distribution that we just approximated.  If we reported the sampling distribution itself, all but the stasticians would throw up their hands in exhasperation (and rightfully so).  Instead, we summarize it with two numbers that make up the \emph{confidence interval}.

According to section 4.2.3, we can calculate a 95\% confidence interval for a sample mean by adding and subtracting 1.96 standard errors to our point estimate.

\Code{hi <- xbar + 1.96*se

lo <- xbar - 1.96*se

c(lo,hi)

abline(v=c(lo,hi),col="red")
}

The last command adds to the plot two red lines representing the confidence interval.  We see that they contain 95\% of the area of our approximate samping distribution and provide a range of plausible values for the sample mean.

\subsubsection*{Changing Sample Size}

\subsubsection*{On Your Own}
So far we have only focused on estimating the mean age of the residents of Millbrae.  Now we'll try to estimate the mean household income.  Take a random sample of size 75 from \texttt{incomes}.
\begin{enumerate}
\item Check the conditions for the sampling distribution of $\bar{x}_{income}$ to be nearly normal.
\item Regardless of whether or not the conditions were met, form the $95\%$ confidence interval for the mean household income.
\item Since you have access to the population, compute the sampling distribution for $\bar{x}_{income}$ by taking 5000 samples from the population of size 75 and  computing 5000 sample means.  Describe this sampling distribution.
\item Plot the normal approximation to the sampling distribution on top of the histogram.  How good of an appromiation is it?

\end{enumerate}


\end{document}


